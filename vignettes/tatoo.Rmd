---
title: "Tatoo package vignette"
author: "Stefan Fleck"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Tatoo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r message=FALSE, warning=FALSE}
library(dplyr)
library(tatoo)
```

# Introduction

Tatoo ("Table Tools") provides three straight-forward helper to combine multiple
`data.frames` to tables that are otherwise awkward to create in base-r, and a
way to add metadata (id, title, ...) to a table. 

Tatoo tables can directly be saved to .xlsx files, or convert to `Workbook` 
objects with `as_workbook()` so that you can process them further using the 
awesome `openxlsx` package. While tatoo implements convenient print methods so 
that you can preview the tables you created in the console, most of the
functionality provided by this package only makes real sense for .xlsx export.

# Setup example data
```{r}
df1 <- iris %>% 
  dplyr::group_by(Species) %>% 
  dplyr::summarise(
    length = mean(Sepal.Length),
    width  = mean(Sepal.Width)) %>% 
   hammr::df_round(2)

df2 <- iris %>% 
  dplyr::group_by(Species) %>% 
  dplyr::summarise(
    length = sd(Sepal.Length),
    width  = sd(Sepal.Width)) %>% 
  hammr::df_round(2)
```

# Tagged tables

![Tagged table](tagged_table.png)

`tag_table()` allows you to attach metadata to a `data.frame` or `Tatoo_table`.
This allows for captioning for printing and .xlsx export.

```{r}
# Create metadata object
ex_meta <- tt_meta(
  table_id  = 'T01',  
  title     = 'Example Table', 
  longtitle = 'This is an example for tables created with the tatool package', 
  subtitle  = 'It features a lot of titles and very little data', 
  footer    = c('This table was created from the iris dataset', 
                'It consists of 3 different types of irisesâ€™',
                 '(Setosa, Versicolour, and Virginica)') 
)

# Create metadata object
tt1 <- tag_table(
  df1,
  meta = ex_meta
)

print(tt1)
```

Metdata cann also be assigned an modified via set function.

```{r}
meta(df1)  <- ex_meta # df1 gets automatically converted to a Tagged_table
title(df1) <- 'A second example with less titles'
longtitle(df1) <- NULL
subtitle(df1) <- NULL
footer(df1) <- NULL

print(df1)
```


# Mashed tables

![](mashed_table.png)

Combine two `data.frames` in such a way that you and up with alternating rows
or columns. Internally, a `Mashed_table` is just a list of two or more tables,
and metadata on how to combine them.

`Mashed_tables` can be constructed from individual `data.frames` or a `list` of 
`data.frames`

```{r}
mashed_table <- mash_table(df1, df2)
mashed_table <- mash_table_list(list(df1, df2))

title(mashed_table) <- 'A mashed table'
subtitle(mashed_table) <- 
  'Two or more tables mashed together so that rows or columns alternate'

print(mashed_table)
```

Additional formatting parameters can be saved as attributes to a mash table. 
Those attributes honored by the print and (more significantly) the as_workbook 
methods.

```{r}
mash_table(df1, df2, mash_method = 'row', insert_blank_row = TRUE)
mash_table(df1, df2, mash_method = 'col', id_vars = 'Species')
```

The display parameters are just saved as attributes, and can be modified
conveniently via set functions

```{r}
attributes(mashed_table)

mash_method(mashed_table) <- 'col'
id_vars(mashed_table) <- 'Species'
suffixes(mashed_table) <- c('.mean', '.sd')

print(mashed_table)
```

All Tatoo table classes can be converted to openxlsx Workbooks via 
`as_workbook()`. Examples for finished `.xlsx` files are beyond the scope
of this vignette.

```{r message=FALSE}
as_workbook(mashed_table)
```



## rmash and cmash

`rmash()` and `cmash()` are convient shortcut functions if you just need to quickly
mash together a `data.frame` (similar to `rbind()` and `cbind()`). Note that the
result is a `data.table` and not a `data.frame`, so if you are not familiar with
the `data.table` package you might want to manually convert the result to a
`data.frame` to prevent headaches.
```{r}
rmash(mashed_table) # rmash can be used on a Mash_table
rmash(df1, df2) # or on several data.frames
rmash(df1, df2, insert_blank_row = TRUE)

cmash(mashed_table)
cmash(df1, df2, suffixes = c('_mean', '_sd'))
cmash(df1, df2, id_vars = 'Species') %>% 
  as.data.frame()
```


# Composite tables

![Composite Table](composite_table.png)

`comp_table()` works like `cbind()`, but separate super-headings are preserved 
for each table. 

```{r}
composite_table <- comp_table(
  df1, 
  df2
)
print(composite_table)
```

Names for each table can be provided directly, or alternatively the 
`comp_table_list()` constructor can be used as above with mash_table.

```{r}
ct2 <- comp_table(
  mean = df1, 
  sd = df2
)

ct2 <- comp_table_list(
  list(
    mean = df1,
    sd = df2)
)

print(ct2)
```

The id_vars argument can be used to combine the tables via merge, rather
than via cbind

```{r}
ct3 <- comp_table(
  mean = df1, 
  sd = df2,
  id_vars = 'Species'
)
```


# Stacked tables

![Stacked Table](stacked_table.png)

Stacked tables simply stack two tables above each other. The only meaningful
usecase for this at the moment is to put several tables above each other
on the same `.xlsx` sheet. A stack table can be consist of an arbitrary number
of data.frames or Tatoo_tables -- except other Stacked_tables.

```{r}
tst <- tatoo::stack_table(
  df1, 
  df2
)

print(tst)
```




`Stacked_tables`, and the element tables they consist of, can also be tagged:

```{r}
longtitle(tst) <- 'Stacked tables can be tagged'
subtitle(tst) <- 'since they are just another subclass of Tatoo_table'

title(tst[[1]]) <- 'So can each element table of a stack table'
title(tst[[2]]) <- 'Which gives you a lot of freedom for composing excel sheets'
```


# Tatoo Report

```{r}

tr <- compile_report(mashed_table, ct3, tt1, tst)

print(tr)

save_xlsx(tr, 'report_example.xlsx', overwrite = TRUE)
```



# Technical details

* Internally tatoo makes heavy use of the `data.table` package
